<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Связанные компании</title>
  <script src="https://api.bitrix24.com/api/v1/"></script>
</head>
<body>
  <div id="app">Загрузка...</div>
  <script>
    BX24.init(function() {
      // Получаем ID текущей компании
      BX24.getCurrentEntityId(function(entityId) {
        if (!entityId) {
          document.getElementById('app').innerHTML = 'Не удалось получить ID компании';
          return;
        }

        // Запрашиваем связанные компании
        BX24.callMethod('crm.company.list', {
          filter: {
            'UF_CRM_1758782866': entityId // ID поля связи
          },
          select: ['TITLE', 'PHONE', 'EMAIL']
        }, function(result) {
          if (result.error()) {
            document.getElementById('app').innerHTML = 'Ошибка: ' + result.error().error_description;
            return;
          }

          const companies = result.data;
          if (companies.length === 0) {
            document.getElementById('app').innerHTML = 'Связанных компаний нет';
            return;
          }

          let html = '<table border="1"><tr><th>Название</th><th>Телефон</th><th>Email</th></tr>';
          companies.forEach(company => {
            html += `<tr><td>${company.TITLE || '-'}</td><td>${company.PHONE || '-'}</td><td>${company.EMAIL || '-'}</td></tr>`;
          });
          html += '</table>';

          document.getElementById('app').innerHTML = html;
        });
      });
    });
  </script>
</body>
</html>

